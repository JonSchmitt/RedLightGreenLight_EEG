<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800">
  <defs>
    <style>
      .box { fill: white; stroke: #333; stroke-width: 2; }
      .controller { fill: #ffebee; stroke: #c62828; stroke-width: 2; }
      .model { fill: #e8f5e9; stroke: #2e7d32; stroke-width: 2; }
      .view { fill: #e3f2fd; stroke: #1565c0; stroke-width: 2; }
      .external { fill: #fff9c4; stroke: #f57f17; stroke-width: 2; }
      
      .text { font-family: 'Segoe UI', Arial, sans-serif; font-size: 12px; fill: #212121; }
      .text-small { font-family: 'Segoe UI', Arial, sans-serif; font-size: 10px; fill: #424242; }
      .text-title { font-family: 'Segoe UI', Arial, sans-serif; font-size: 15px; font-weight: bold; fill: #212121; }
      .text-code { font-family: 'Consolas', 'Courier New', monospace; font-size: 10px; fill: #1565c0; }
      
      .arrow { fill: none; stroke: #666; stroke-width: 2; marker-end: url(#arrowhead); }
      .arrow-call { fill: none; stroke: #c62828; stroke-width: 2; marker-end: url(#arrowhead-red); }
      .arrow-data { fill: none; stroke: #2e7d32; stroke-width: 2; stroke-dasharray: 5,3; marker-end: url(#arrowhead-green); }
      .arrow-render { fill: none; stroke: #1565c0; stroke-width: 2; marker-end: url(#arrowhead-blue); }
    </style>
    
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#c62828" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2e7d32" />
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1565c0" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="800" fill="#fafafa"/>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" class="text-title" style="font-size: 18px;">MVC Pattern - Beispiel: GreenLightState</text>
  
  <!-- State Wrapper -->
  <rect x="50" y="60" width="700" height="520" fill="white" stroke="#9e9e9e" stroke-width="2" stroke-dasharray="8,4" rx="10"/>
  <text x="60" y="85" class="text-title">GreenLightState (Facade + SettingsObserver)</text>
  
  <!-- Controller -->
  <g id="controller">
    <rect x="80" y="110" width="280" height="200" class="controller" rx="8"/>
    <text x="220" y="135" text-anchor="middle" class="text-title">GLSController</text>
    
    <text x="90" y="160" class="text" font-weight="bold">Verantwortlichkeiten:</text>
    <text x="100" y="180" class="text-small">• Orchestriert Model + View</text>
    <text x="100" y="195" class="text-small">• Verwaltet Game Loop</text>
    <text x="100" y="210" class="text-small">• Entscheidet State Transitions</text>
    <text x="100" y="225" class="text-small">• Steuert Musik (Fade In/Out)</text>
    
    <text x="90" y="250" class="text" font-weight="bold">Methoden:</text>
    <text x="100" y="268" class="text-code">enter(game_model)</text>
    <text x="100" y="283" class="text-code">update(dt, game_model) → State</text>
    <text x="100" y="298" class="text-code">_decide_next_state(gm) → State</text>
  </g>
  
  <!-- Model -->
  <g id="model">
    <rect x="80" y="340" width="280" height="200" class="model" rx="8"/>
    <text x="220" y="365" text-anchor="middle" class="text-title">GLSModel</text>
    
    <text x="90" y="390" class="text" font-weight="bold">State Data:</text>
    <text x="100" y="408" class="text-code">_switch_time: int = 10</text>
    <text x="100" y="423" class="text-code">_warn_time: int = 5</text>
    <text x="100" y="438" class="text-code">_time_passed: float = 0.0</text>
    
    <text x="90" y="463" class="text" font-weight="bold">Methoden:</text>
    <text x="100" y="481" class="text-code">update_time_in_phase(dt)</text>
    <text x="100" y="496" class="text-code">reset_time_in_phase()</text>
    <text x="100" y="511" class="text-code">switch_phase() → bool</text>
    <text x="100" y="526" class="text-code">get_remaining_time() → float</text>
  </g>
  
  <!-- View -->
  <g id="view">
    <rect x="420" y="340" width="310" height="200" class="view" rx="8"/>
    <text x="575" y="365" text-anchor="middle" class="text-title">GLSView</text>
    
    <text x="430" y="390" class="text" font-weight="bold">UI Components:</text>
    <text x="440" y="408" class="text-code">_screen: pygame.Surface</text>
    <text x="440" y="423" class="text-code">_manager: UIManager</text>
    <text x="440" y="438" class="text-code">_time_label: UILabel</text>
    <text x="440" y="453" class="text-code">_warning_label: UILabel</text>
    
    <text x="430" y="478" class="text" font-weight="bold">Methoden:</text>
    <text x="440" y="496" class="text-code">show(dt) → None</text>
    <text x="440" y="511" class="text-code">_update_labels() → None</text>
    <text x="440" y="526" class="text-code">_initialize_ui() → None</text>
  </g>
  
  <!-- External Dependencies -->
  <g id="external">
    <!-- SettingsModel -->
    <rect x="820" y="90" width="180" height="80" class="external" rx="5"/>
    <text x="910" y="115" text-anchor="middle" class="text-title">SettingsModel</text>
    <text x="830" y="138" class="text-small">get_switch_time()</text>
    <text x="830" y="153" class="text-small">get_warning_time()</text>
    
    <!-- MusicManager -->
    <rect x="820" y="190" width="180" height="80" class="external" rx="5"/>
    <text x="910" y="215" text-anchor="middle" class="text-title">MusicManager</text>
    <text x="830" y="238" class="text-small">play(path, fade_in)</text>
    <text x="830" y="253" class="text-small">stop(fade_out)</text>
    
    <!-- GamePhaseStateFactory -->
    <rect x="820" y="290" width="180" height="80" class="external" rx="5"/>
    <text x="910" y="315" text-anchor="middle" class="text-title">GamePhaseStateFactory</text>
    <text x="830" y="338" class="text-small">create_red_light_state()</text>
    <text x="830" y="353" class="text-small">create_game_over_state()</text>
    
    <!-- GameModel (Context) -->
    <rect x="820" y="400" width="330" height="140" class="external" rx="5"/>
    <text x="985" y="425" text-anchor="middle" class="text-title">GameModel (Context Object)</text>
    <text x="830" y="450" class="text" font-weight="bold">Queries für Spiellogik:</text>
    <text x="840" y="470" class="text-code">update_phase_info(GamePhasesEnum.GLS)</text>
    <text x="840" y="485" class="text-code">get_all_players_dead() → bool</text>
    <text x="840" y="500" class="text-code">get_entities() → List[EntityStateMachine]</text>
    <text x="840" y="515" class="text-code">restart_game()</text>
    <text x="830" y="533" class="text-small" style="font-style: italic;">↳ Mediator zwischen GamePhase ↔ Entities</text>
  </g>
  
  <!-- Arrows - MVC Internal -->
  <!-- Controller to Model -->
  <path d="M 220 310 L 220 340" class="arrow-call"/>
  <text x="230" y="330" class="text-small" fill="#c62828">update</text>
  
  <!-- Controller to View -->
  <path d="M 360 210 L 575 210 L 575 340" class="arrow-call"/>
  <text x="470" y="225" class="text-small" fill="#c62828">show()</text>
  
  <!-- Model to View (data) -->
  <path d="M 360 440 L 420 440" class="arrow-data"/>
  <text x="390" y="430" class="text-small" fill="#2e7d32">data</text>
  
  <!-- Arrows - External Dependencies -->
  <!-- Controller to SettingsModel -->
  <path d="M 360 150 L 500 150 Q 550 150 550 130 L 820 130" class="arrow-call"/>
  
  <!-- Controller to MusicManager -->
  <path d="M 360 200 L 500 200 Q 550 200 550 230 L 820 230" class="arrow-call"/>
  
  <!-- Controller to Factory -->
  <path d="M 360 250 L 500 250 Q 550 250 550 330 L 820 330" class="arrow-call"/>
  
  <!-- Controller to GameModel -->
  <path d="M 360 280 L 500 280 Q 550 280 550 470 L 820 470" class="arrow-call"/>
  
  <!-- View to GameModel (queries) -->
  <path d="M 730 440 L 750 440 Q 780 440 780 490 L 820 490" class="arrow-data"/>
  
  <!-- Flow Diagram -->
  <g id="flow">
    <rect x="50" y="600" width="1100" height="170" fill="white" stroke="#9e9e9e" stroke-width="2" rx="8"/>
    <text x="60" y="625" class="text-title">Ablauf pro Frame:</text>
    
    <!-- Step boxes -->
    <rect x="70" y="640" width="160" height="110" fill="#ffebee" stroke="#c62828" stroke-width="1" rx="5"/>
    <text x="150" y="660" text-anchor="middle" class="text" font-weight="bold">1. Controller.update()</text>
    <text x="80" y="680" class="text-small">• Model.update_time(dt)</text>
    <text x="80" y="695" class="text-small">• View.show(dt)</text>
    <text x="80" y="710" class="text-small">• MusicManager.update()</text>
    <text x="80" y="725" class="text-small">• decide_next_state()</text>
    <text x="80" y="740" class="text-small">• return State</text>
    
    <rect x="250" y="640" width="160" height="110" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1" rx="5"/>
    <text x="330" y="660" text-anchor="middle" class="text" font-weight="bold">2. Model Updates</text>
    <text x="260" y="680" class="text-small">• _time_passed += dt</text>
    <text x="260" y="695" class="text-small">• Berechnet:</text>
    <text x="270" y="710" class="text-small">- Remaining Time</text>
    <text x="270" y="725" class="text-small">- Warning Time</text>
    <text x="270" y="740" class="text-small">- Switch Phase?</text>
    
    <rect x="430" y="640" width="160" height="110" fill="#e3f2fd" stroke="#1565c0" stroke-width="1" rx="5"/>
    <text x="510" y="660" text-anchor="middle" class="text" font-weight="bold">3. View Renders</text>
    <text x="440" y="680" class="text-small">• screen.fill(green)</text>
    <text x="440" y="695" class="text-small">• Update Labels:</text>
    <text x="450" y="710" class="text-small">- "T: 7.3s"</text>
    <text x="450" y="725" class="text-small">- "Stop in: 2.1s"</text>
    <text x="440" y="740" class="text-small">• manager.draw_ui()</text>
    
    <rect x="610" y="640" width="160" height="110" fill="#fff9c4" stroke="#f57f17" stroke-width="1" rx="5"/>
    <text x="690" y="660" text-anchor="middle" class="text" font-weight="bold">4. State Decision</text>
    <text x="620" y="680" class="text-small">Query GameModel:</text>
    <text x="620" y="695" class="text-small">• All players dead?</text>
    <text x="630" y="710" class="text-small">→ GameOverState</text>
    <text x="620" y="725" class="text-small">• Timer expired?</text>
    <text x="630" y="740" class="text-small">→ RedLightState</text>
    
    <rect x="790" y="640" width="160" height="110" fill="#ffebee" stroke="#c62828" stroke-width="1" rx="5"/>
    <text x="870" y="660" text-anchor="middle" class="text" font-weight="bold">5. Transition</text>
    <text x="800" y="680" class="text-small">Bei State-Wechsel:</text>
    <text x="800" y="695" class="text-small">• model.reset_time()</text>
    <text x="800" y="710" class="text-small">• return new_state</text>
    <text x="800" y="730" class="text-small">Sonst:</text>
    <text x="800" y="745" class="text-small">• return self</text>
    
    <rect x="970" y="640" width="160" height="110" fill="white" stroke="#9e9e9e" stroke-width="1" rx="5"/>
    <text x="1050" y="660" text-anchor="middle" class="text" font-weight="bold">6. GameApp Loop</text>
    <text x="980" y="680" class="text-small">if new != current:</text>
    <text x="990" y="695" class="text-small">current.exit()</text>
    <text x="990" y="710" class="text-small">current = new</text>
    <text x="990" y="725" class="text-small">current.enter()</text>
    <text x="980" y="740" class="text-small">else: continue</text>
    
    <!-- Flow arrows -->
    <path d="M 230 695 L 250 695" class="arrow"/>
    <path d="M 410 695 L 430 695" class="arrow"/>
    <path d="M 590 695 L 610 695" class="arrow"/>
    <path d="M 770 695 L 790 695" class="arrow"/>
    <path d="M 950 695 L 970 695" class="arrow"/>
  </g>
</svg>